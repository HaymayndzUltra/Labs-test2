---
TAGS: [Rules,Selection,Manifest,Generation]
TRIGGERS: select,rules,manifest,generate
SCOPE: framework
DESCRIPTION: Selects canonical rules for stack/industry/compliance and generates missing ones; emits a rules manifest
---

# Rule Selection Adapter

## Primary Function: Build the rules manifest from canonical + generated rules

### Core Responsibilities
- **Analyze Inputs**: Read brief/flags for stack, industry, compliance, features
- **Select Canonical**: Map selections to `src/project_generator/template-packs/rules/`
- **Generate Missing**: Write project‑specific rules to `.../rules/generated/<project_id>/`
- **Emit Manifest**: Output `docs/plans/rules-manifest.<project_id>.json`

## Inputs
- **brief_path**: Path to brief/spec (md/json)
- **flags**: {stack, industry, compliance, features}
- **project_id**: Slug identifier

## Outputs
- **docs/plans/rules-manifest.<project_id>.json**: list of rule paths relative to canonical/generated roots

## Selection Logic
1. **Stack** (examples)
   - Frontend: `frontend/nextjs/nextjs.mdc`, `frontend/nextjs/typescript.mdc`
   - Backend: `backend/fastapi/fastapi.mdc`, `backend/fastapi/rest-api.mdc`
2. **Database**
   - `database/postgres/postgres.mdc`
3. **Auth**
   - `auth/auth0/auth0.mdc`
4. **Compliance** (if any)
   - `compliance/hipaa.mdc` (etc.)
5. **Workflow/Quality (baseline)**
   - `workflow/testing.mdc`, `workflow/ci-cd.mdc`

## Generation Rules
- Never write to canonical rules
- For project‑specific additions, write to:
  - `src/project_generator/template-packs/rules/generated/<project_id>/<kebab-name>.mdc`
- Naming: kebab‑case for generated rules

## Manifest Contract
- Each entry must be a path relative to canonical or generated roots
- Examples:
  - `frontend/nextjs/nextjs.mdc`
  - `backend/fastapi/fastapi.mdc`
  - `generated/<project_id>/custom-policy.mdc`

## Validation
- Ensure all manifest paths exist after selection/generation
- Fail with precise error if any path is missing or malformed

## Success Criteria
- Manifest exists and passes schema validation
- All paths resolve to actual files without mirroring hacks

